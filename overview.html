<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="API Reference" href="api.html" /><link rel="prev" title="Welcome to MATLAB Tensorsâ€™s documentation!" href="index.html" />
        <link rel="canonical" href="https://peske.github.io/matlab-tensors/overview.html" />

    <meta name="generator" content="sphinx-5.3.0, furo 2022.09.29"/>
        <title>Overview - MATLAB Tensors 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">MATLAB Tensors 1.0.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">MATLAB Tensors 1.0.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h1>
<section id="the-problem-motivation">
<h2>The Problem / Motivation<a class="headerlink" href="#the-problem-motivation" title="Permalink to this heading">#</a></h2>
<p>Let us start with a real-life problem that was the original motive for this
package. The task was to create a 3D tensor from several vectors/matrices so
that:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\frac{{\partial }^2v_G}{{\left(\partial m\right)}^2}\ [n*n*n]\to
\frac{{\partial }^2v_{Gi}}{\partial m_j\partial m_k}=
\frac{{\overline{r}}_i}{{\mu }^2_{Fi}}\frac{\partial {\mu }_{Fi}}{\partial m_j}
\frac{\partial {\mu }_{Fi}}{\partial m_k}
\left(- \frac{v_j}{{\overline{r}}_j} + \frac{2}{R^2_G}\frac{x_i}{{\mu }_{Fi}}
- \frac{v_k}{{\overline{r}}_k}\right)\]</div>
</div>
<p>The equation looks scarier than necessary because of the notation used (partial
derivatives, Greek letters, etc.). Here is a much simpler version that
illustrates the problem solved by this package:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\Large T_{[m*n*p]} \to t_{i,j,k}=a_i*b_j*c_k\]</div>
</div>
<p>On the right side, we only have three vectors: <span class="math notranslate nohighlight">\(a_{[m]}\)</span> with <span class="math notranslate nohighlight">\(m\)</span>
elements, <span class="math notranslate nohighlight">\(b_{[n]}\)</span> with <span class="math notranslate nohighlight">\(n\)</span> elements, and <span class="math notranslate nohighlight">\(c_{[p]}\)</span> with
<span class="math notranslate nohighlight">\(p\)</span> elements. The result on the left side should be a 3D tensor of size
<span class="math notranslate nohighlight">\([m, n, p]\)</span>.</p>
</section>
<section id="naive-solution">
<h2>Naive Solution<a class="headerlink" href="#naive-solution" title="Permalink to this heading">#</a></h2>
<p>The first intuition would be to solve this problem by using loops, as in the
following example:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>T<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">loopSolution</span><span class="p">(</span>a, b, c<span class="p">)</span><span class="w"></span>
<span class="c">%LOOPSOLUTION Calculates the tensor by using loops.</span><span class="w"></span>
<span class="c">%   Input arguments a, b and c are column vectors.</span><span class="w"></span>

<span class="w">    </span><span class="c">% Get dimensions:</span><span class="w"></span>
<span class="w">    </span><span class="n">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c">% Initialize the result:</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c">% Calculate:</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">m</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="w"></span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">p</span><span class="w"></span>
<span class="w">                </span><span class="n">T</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="w"> </span><span class="nb">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="p">(</span><span class="n">k</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<p>Although accurate, this implementation suffers one problem: performance. We have
a loop within a loop, within a loop. If vectors <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span>, and
<span class="math notranslate nohighlight">\(c\)</span> are huge, it will lead to too many passes. For example, if <span class="math notranslate nohighlight">\(a\)</span>,
<span class="math notranslate nohighlight">\(b\)</span> and <span class="math notranslate nohighlight">\(c\)</span> have 100 elements each, it would cause <strong>million loop
passes</strong>. If they are 1000 elements each, it will cause <strong>billion passes</strong> and
take some time. It is a well-known fact that loops are not efficient in MATLAB.</p>
</section>
<section id="the-solution">
<h2>The Solution<a class="headerlink" href="#the-solution" title="Permalink to this heading">#</a></h2>
<p>The same problem can be solved by using <code class="xref mat mat-func docutils literal notranslate"><span class="pre">tensorHadamard()</span></code> function. The
function does not contain any loops internally, thus being much faster than the
approach with loops. Performance benefits are more and more significant as the
size of the input vectors increases. For example, when the input vectors are one
thousand elements each, the approach with loops takes about 50 seconds, while
the approach with <code class="xref mat mat-func docutils literal notranslate"><span class="pre">tensorHadamard()</span></code> function takes about 4 seconds.</p>
<p>The following line shows how we should call the function to get the same result
as with <code class="docutils literal notranslate"><span class="pre">loopSolution</span></code> function from above:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tensorHadamard</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Arguments:</p>
<ul class="simple">
<li><p>The first argument is <code class="docutils literal notranslate"><span class="pre">tSize</span></code>, and it specifies the size of the resulting
tensor. This argument can be:</p>
<ul>
<li><p>An empty array (<code class="docutils literal notranslate"><span class="pre">[]</span></code>), in which case the function will try to
infer the size of the resulting tensor based on other arguments. It will
throw an error if the size cannot be inferred.</p></li>
<li><p>A scalar, as we have set it in this example, in which case it represents the
number of dimensions of the resulting tensor. We have provided the value
<code class="docutils literal notranslate"><span class="pre">3</span></code>, meaning that the resulting tensor should have three dimensions (3D
tensor). Actual size along these dimensions is not provided, and the
function will try to infer it. Again, the function will raise an error if
the actual size cannot be inferred.</p></li>
<li><p>A vector, in which case the vector elements represent the size along the
corresponding dimension. We can set some of the vector elements to <code class="docutils literal notranslate"><span class="pre">0</span></code>, in
which case the function will try to infer the size along this dimension
based on the remaining arguments. For example, providing the value
<code class="docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">3,</span> <span class="pre">0]</span></code> means that the lengths along the first two dimensions are
<code class="docutils literal notranslate"><span class="pre">2</span></code> and <code class="docutils literal notranslate"><span class="pre">3</span></code>, respectively, and that the length along the third dimension
should be inferred. Once more, if the function fails to infer the value, the
function will raise an error.</p></li>
</ul>
</li>
<li><p>The second argument is <code class="docutils literal notranslate"><span class="pre">a</span></code>, a tensor of the order lesser than or equal to
the order of the resulting tensor. In our example, it is a vector.</p></li>
<li><p>The third argument is <code class="docutils literal notranslate"><span class="pre">dimA</span></code>, a vector that describes how the previous
argument (<code class="docutils literal notranslate"><span class="pre">a</span></code>) should be converted into a tensor. It maps the dimensions of
the input argument <code class="docutils literal notranslate"><span class="pre">a</span></code> with the dimensions of the resulting tensor. In our
example, it is <code class="docutils literal notranslate"><span class="pre">1</span></code>, meaning that vector <code class="docutils literal notranslate"><span class="pre">a</span></code> should be aligned along the
first dimension of the resulting tensor and then repeated along the second and
third dimensions. It means that the size of <code class="docutils literal notranslate"><span class="pre">dimA</span></code> must be equal to the
number of dimensions of <code class="docutils literal notranslate"><span class="pre">a</span></code>. This argument is optional, and if not provided
or empty, it will default to <code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">a</span></code> is a vector, <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code> if <code class="docutils literal notranslate"><span class="pre">a</span></code>
is a matrix, <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> if <code class="docutils literal notranslate"><span class="pre">a</span></code> is a 3D tensor, etc.</p></li>
<li><p>The remaining arguments are just repetitions of the previously described two
(<code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">dimA</span></code>). We can add as many such argument pairs as needed, where
every pair defines a new tensor (<code class="docutils literal notranslate"><span class="pre">a</span></code>) and its orientation in the resulting
tensor (<code class="docutils literal notranslate"><span class="pre">dimA</span></code>).</p></li>
</ul>
</section>
<section id="solving-the-original-problem">
<h2>Solving the Original Problem<a class="headerlink" href="#solving-the-original-problem" title="Permalink to this heading">#</a></h2>
<p>Let us now solve the original problem we have started with:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\frac{{\partial }^2v_G}{{\left(\partial m\right)}^2}\ [n*n*n]\to
\frac{{\partial }^2v_{Gi}}{\partial m_j\partial m_k}=
\frac{{\overline{r}}_i}{{\mu }^2_{Fi}}\frac{\partial {\mu }_{Fi}}{\partial m_j}
\frac{\partial {\mu }_{Fi}}{\partial m_k}
\left(- \frac{v_j}{{\overline{r}}_j} + \frac{2}{R^2_G}\frac{x_i}{{\mu }_{Fi}}
- \frac{v_k}{{\overline{r}}_k}\right)\]</div>
</div>
<p>Note that partial derivatives from the equation above are simply matrices:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\frac{\partial {\mu }_{Fi}}{\partial m_j} = D_{i,j}\]</div>
</div>
<p>After replacing that and simplifying the notation by removing some unnecessary
subscripts, and replacing Greek with Latin letters, we get the following:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[T_{[n*n*n]}\to t_{i,j,k}=\frac{r_i}{m^2_i} * D_{i,j} * D_{i,k} *
\left(-\frac{v_j}{r_j} + \frac{2}{R^2}\frac{x_i}{m_i} - \frac{v_k}{r_k}\right)\]</div>
</div>
<p>Where <span class="math notranslate nohighlight">\(T_{[n,n,n]}\)</span> is the output tensor, <span class="math notranslate nohighlight">\(R\)</span> is an input scalar,
<span class="math notranslate nohighlight">\(D_{[n,n]}\)</span> is an input matrix, and several input vectors: <span class="math notranslate nohighlight">\(r[n]\)</span>,
<span class="math notranslate nohighlight">\(m[n]\)</span>, <span class="math notranslate nohighlight">\(v[n]\)</span>, and <span class="math notranslate nohighlight">\(x[n]\)</span>.</p>
<p>One possible solution:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Start from everything in front of the parenthesis:</span><span class="w"></span>
<span class="n">T</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tensorHadamard</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">./</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">.^</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span><span class="w"></span>
<span class="c">% Pre-calculate v ./ r because it appears twice:</span><span class="w"></span>
<span class="n">vr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">./</span><span class="w"> </span><span class="n">r</span><span class="p">;</span><span class="w"></span>
<span class="c">% Finalize:</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">tensorHadamard</span><span class="p">([</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">],</span><span class="w"> </span><span class="n">vr</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">\</span><span class="w"></span>
<span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">R</span>^<span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">tensorHadamard</span><span class="p">([</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">],</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">./</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">\</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">tensorHadamard</span><span class="p">([</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">],</span><span class="w"> </span><span class="n">vr</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Another possible solution:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Pre-calculate v ./ r because it appears twice:</span><span class="w"></span>
<span class="n">vr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">./</span><span class="w"> </span><span class="n">r</span><span class="p">;</span><span class="w"></span>
<span class="c">% Start from everything within the parenthesis:</span><span class="w"></span>
<span class="n">T</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tensorHadamard</span><span class="p">([</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">],</span><span class="w"> </span><span class="n">vr</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">\</span><span class="w"></span>
<span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">R</span>^<span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tensorHadamard</span><span class="p">([</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">],</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">./</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">\</span><span class="w"></span>
<span class="w">    </span><span class="n">tensorHadamard</span><span class="p">([</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">],</span><span class="w"> </span><span class="n">vr</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
<span class="c">% Finalize:</span><span class="w"></span>
<span class="n">T</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">tensorHadamard</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">./</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">.^</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="api.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API Reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Aleksandar Pesic
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Overview</a><ul>
<li><a class="reference internal" href="#the-problem-motivation">The Problem / Motivation</a></li>
<li><a class="reference internal" href="#naive-solution">Naive Solution</a></li>
<li><a class="reference internal" href="#the-solution">The Solution</a></li>
<li><a class="reference internal" href="#solving-the-original-problem">Solving the Original Problem</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>